<html xmlns = "http://www.w3.org/1999/xhtml">
<meta charset="UTF-8">

<head>
  <title>NDNFit Consumer Webpage</title>

  <script type="text/javascript" src="js/ndn-js.min.js"></script>
  <script type="text/javascript" src="js/consumer.js"></script>
  
  <script type="text/javascript">
    catalogProbeFinishedCallback = function (catalogs) {
      var username = document.getElementById("userInput").value;
      var fetchEncrypted = document.getElementById("fetchEncrypted").checked;
      if (fetchEncrypted) {
        getEncryptedData(catalogs);
      } else {
        getUnencryptedData(catalogs);
      }
    }

    function getCatalogsClick() {
      var username = document.getElementById("userInput").value;
      if (username != "" && username != undefined) {
        getCatalogs(username);
      } else {
        getCatalogs();
      }
    }

    function requestDataAccessClick() {
      var username = document.getElementById("userInput").value;
      if (username != "" && username != undefined) {
        requestDataAccess(username);
      } else {
        requestDataAccess();
      }
    }

    function issueDPUInterestClick() {
      var username = document.getElementById("userInput").value;
      if (username != "" && username != undefined) {
        issueDPUInterest(username);
      } else {
        issueDPUInterest();
      }
    }

    function onDPUNDNData(interest, data) {
      // This is not encapsulated
      console.log("onDPU NDN data: " + data.getName().toUri());
      
    }

    function onDPUNFNData(interest, data) {
      // This is encapsulated
      console.log(data.getContent());
      console.log("onDPU NFN data: " + data.getName().toUri());
      newData = new Data();
      newData.wireDecode(data.getContent());
      console.log("onDPU NFN data: " + newData.getName().toUri());
      console.log(newData.getContent().toString('binary'));
      document.getElementById("content").innerHTML += "NFN replied with encapsulated data; outer name: " + data.getName().toUri() + " inner name: " + newData.getName().toUri() + " ; content: " + newData.getContent().toString('binary') + "<br>";
    }

    function onDPUNFNTimeout(interest) {
      console.log("DPU NFN interest times out: " + interest.getName().toUri());
    }
  </script>
</head>

<body>
  <input id="userInput" type="text"></input> <br>

  <input id="fetchEncrypted" type="checkbox">Fetch encrypted</input> <br>
  <button id="userBtn" onclick="getUsers()">Scan users</button> <br>
  <button id="catalogBtn" onclick="getCatalogsClick()">Get data</button> <br>
  <button id="dpuBtn" onclick="issueDPUInterestClick()">Call DPU (Bounding box)</button> <br>
  <button id="dpuBtn" onclick="requestDataAccessClick()">Request data access</button> <br>
  <p id="content">Content: <br/></p> <br>

  <canvas id="plotCanvas" width="400" height="400"></canvas>
</body>

<html>